<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Log Level Manager</title>
<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.1/jquery.min.js"></script>
<script type="text/javascript">
	var manager = {};

	$(document).ready(function() {
		manager.get();
		
		$("form").on("submit", manager.submit);
	})

	manager.get = function() {
		$.get("api/manager", function(json) {
			if(json.status === "success") {
				$("div:first").text(json.implementation)
				manager.load(json.levels, json.loggers);
			}
		})
	}

	manager.load = function(levels, loggers) {		
		$("form > table")
			.children()
				.empty()
			.end()
			.children("thead")
				.each(function() {
					var row = $("<tr><td></td></tr>");
					for(var i = 0; i < levels.length; i++) {
						row.append("<td>" + levels[i] + "</td>");
					}
					$(this).append(row);
				})
			.end()
			.children("tbody")
				.each(function() {
					var tbody = $(this);
					var template = $("<tr><td></td></tr>");
					
					for(var i = 0; i < levels.length; i++) {
						template.append("<td><input type='radio' value='" + levels[i] + "' title='" + levels[i] + "'/></td>")
					}
					
					for(logger in loggers) {
						var row = template.clone()
							.children("td:first")
								.text(logger)
							.end()
							.find("input").each(function() {
								this.name = logger;
								if(this.value === loggers[logger]) {
									this.checked = true;
								}
							})
							.end();
						tbody.append(row);
					}
				})
			.end();
		
		$("form > table > tbody > tr input:checked").each(function() {
			var active = $(this);
			active.parents("tr:first").prop("active", active.val());
		})
	}
	
	manager.submit = function() {
		var parameters = {};
		
		$("form > table > tbody > tr input:checked").each(function() {
			var input = $(this);
			var active = input.parents("tr:first").prop("active");
			
			if(active !== input.val()) {
				parameters[input.attr("name")] = input.attr("value");
			}
		})
					
		$.post("api/manager", parameters, function() {
			manager.get();
		});
		
		return false;
	}
</script>
</head>
<body>
	<div></div>
	<form method="POST">
		<table>
			<thead></thead>
			<tbody></tbody>
		</table>
		<input type="submit" value="Update"/>
		<input type="reset" value="Reset"/>
	</form>
</body>
</html>